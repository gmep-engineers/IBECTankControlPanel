<div class="home-container">
  <div class="home-content-container">
    <div class="home-title-container">I-BEC Tank Control</div>
    <div class="machine-id-container">
      <div>Machine ID:</div>
      <input id="machine-id" />
    </div>
    <div id="no-machine-id-warning" class="warning-message">
      Machine ID is not set.
    </div>
    <div id="execution-error" class="warning-message"></div>
    <div class="active-command-container">
      <div>Active command</div>
      <div id="active-command">None</div>
    </div>
  </div>
</div>
<script>
  var machines$id = "";
  var currentCommand = null;
  const sendCommand = async function (command_types$type, machines$command_id) {
    if (currentCommand === machines$command_id) {
      return;
    } else {
      currentCommand = machines$command_id;
    }
    if (!machines$id) {
      document.getElementById("no-machine-id-warning").style.display = "block";
      return;
    }
    document.getElementById("no-machine-id-warning").style.display = "none";
    const inactiveCommand = document.getElementById("inactive-command");
    if (inactiveCommand) {
      inactiveCommand.id = "active-command";
    }
    document.getElementById("active-command").innerHTML = command_types$type;

    const res = await fetch("/api/command", {
      headers: { "content-type": "application/json" },
      method: "POST",
      body: JSON.stringify({
        machines$command_id: machines$command_id,
        machines$id: machines$id,
      }),
    });
    if (res.ok) {
      document.getElementById("execution-error").style.display = "none";
    } else {
      const json = await res.json();
      document.getElementById("execution-error").style.display = "block";
      document.getElementById("execution-error").innerHTML = json.error;
    }
  };
  document.addEventListener("keydown", async (e) => {
    const machineIdInput = document.getElementById("machine-id");
    if (document.activeElement === machineIdInput) {
      return;
    }
    machines$id = machineIdInput.value;
    if (e.key === "ArrowUp") {
      await sendCommand("ArrowUp", 1);
    } else if (e.key === "ArrowDown") {
      await sendCommand("ArrowDown", 2);
    } else if (e.key === "ArrowLeft") {
      await sendCommand("ArrowLeft", 3);
    } else if (e.key === "ArrowRight") {
      await sendCommand("ArrowRight", 4);
    } else if (e.key === " ") {
      await sendCommand("Space", 5);
    } else if (e.key === "1") {
      await sendCommand("Speed 1", 6);
    } else if (e.key === "2") {
      await sendCommand("Speed 2", 7);
    } else if (e.key === "3") {
      await sendCommand("Speed 3", 8);
    }
  });
  document.addEventListener("keyup", async (e) => {
    const machineIdInput = document.getElementById("machine-id");
    if (document.activeElement === machineIdInput) {
      return;
    }
    machines$id = machineIdInput.value;
    if (e.key === "ArrowUp") {
      await sendCommand("Space", 5);
    } else if (e.key === "ArrowDown") {
      await sendCommand("Space", 5);
    } else if (e.key === "ArrowLeft") {
      await sendCommand("Space", 5);
    } else if (e.key === "ArrowRight") {
      await sendCommand("Space", 5);
    } else if (e.key === " ") {
      await sendCommand("Space", 5);
    }
  });
</script>
<div id="app"></div>
<!-- <script>
  const searchParams = new URLSearchParams(window.location.search);
  // embedHost is the host that provides the files required to run an TTMV instance.
  // By default, the github pages of this repo can provide the host pages.
  const embedHost = searchParams.has("embedhost")
    ? searchParams.get("embedhost")
    : "http://red5pro.github.io/truetime-multiview";

  // Invoked once the inject script is loaded.
  function onR5ProReady(R5PRO) {
    // Create a new Red5 Pro TrueTime MultiView instance, loaded in an iframe that replaces the `app` element.
    var app = new R5PRO.TTMV("app", {
      width: "100%",
      height: "100%",
      embedHost,
      // The following are parameters to define the TTMV experience.
      host: searchParams.has("host")
        ? searchParams.get("host")
        : `54.176.153.50`,
      debug: true,
      abr: true,
      abrLow: 3,
      abrHigh: 1,
      vodBase: undefined,
      scriptUrl: undefined,
      streamList: [
        { label: "Camera One", streamName: "stream_key2" },
        { label: "Camera Two", streamName: "stream_key6" },
        { label: "Camera Two", streamName: "stream_key10" },
      ],
    });
  }

  // Inject the Red5 Pro TrueTime MultiView script.
  var tag = document.createElement("script");
  tag.src = `${embedHost}/r5pro_ttmv_iframe.js`;
  document.body.parentNode.insertBefore(tag, document.body);
</script> -->
